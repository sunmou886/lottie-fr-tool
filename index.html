<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LottieåŠ¨ç”»å¸§ç‡ä¿®æ”¹å’ŒJsoné¢„è§ˆå·¥å…·</title>
  <meta name="description" content="è‡ªç”±çš„ä¿®æ”¹LottieåŠ¨ç”»å¸§ç‡å¹¶æ”¯æŒé¢„è§ˆ">
  <!-- âœ… favicon / æµè§ˆå™¨æ ‡ç­¾å›¾æ ‡ -->
  <link rel="icon" href="/favicon.ico" sizes="any"> <!-- 16x16 / 32x32 å†…åµŒå¤šåˆ†è¾¨ç‡ -->
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
  <!-- âœ… iOS Safari / Android ä¸»å±å¹•å›¾æ ‡ -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="/site.webmanifest">

  <!-- âœ… Open Graph / ç¤¾äº¤åˆ†äº« -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://example.com/">
  <meta property="og:title" content="LottieåŠ¨ç”»å¸§ç‡ä¿®æ”¹å’ŒJsoné¢„è§ˆå·¥å…·">
  <meta property="og:description" content="è‡ªç”±çš„ä¿®æ”¹LottieåŠ¨ç”»å¸§ç‡å¹¶æ”¯æŒé¢„è§ˆã€‚">
  <meta property="og:image" content="https://example.com/og-image.png">

  <!-- âœ… Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://example.com/">
  <meta name="twitter:title" content="LottieåŠ¨ç”»å¸§ç‡ä¿®æ”¹å’ŒJsoné¢„è§ˆå·¥å…·">
  <meta name="twitter:description" content="è‡ªç”±çš„ä¿®æ”¹LottieåŠ¨ç”»å¸§ç‡å¹¶æ”¯æŒé¢„è§ˆã€‚">
  <meta name="twitter:image" content="https://example.com/og-image.png">

  <style>
    :root {
      --bg: #f7f6f3;
      --card: #ffffff;
      --text: #2b2b2b;
      --muted: #9a9a95;
      --line: #e9e7e2;
      --accent: #46473E;
      --accent-press: #2f2b26;
      --pill-active: #d8e7b9;
      --pill-text: #40443a;
      --shadow: 0 2px 12px rgba(0, 0, 0, .05);
    }

    html,
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 14px/1.6 -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Inter, PingFang SC, Helvetica, Arial, sans-serif;
    }

    .footer {

      padding: 24px 0 40px 0;
      background: #f7f6f3;
      text-align: center;
    }

    .footer-content {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #94928D;
      font-size: 16px;
      text-decoration: none;
      /* å»æ‰ä¸‹åˆ’çº¿ */
      transition: color 0.3s ease;
    }

    .footer-content svg {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .footer-content svg [fill]:not([fill="none"]) {
      fill: currentColor !important;
      transition: fill .25s ease;
    }

    .footer-content svg [stroke]:not([stroke="none"]) {
      stroke: currentColor !important;
      transition: stroke .25s ease;
    }

    /* hover æ•ˆæœ */
    .footer-content:hover {
      color: #46473E;
      /* æ‚¬åœæ—¶ï¼Œæ–‡å­—å’Œå›¾æ ‡ä¸€èµ·å˜è‰² */
    }

    .footer-content:hover {
      color: #46473E;
    }

    .footer-content:hover svg path[fill] {
      fill: #46473E;
      /* å›¾æ ‡é¢œè‰²ä¹Ÿéš hover å˜åŒ– */
    }



    .wrap {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 20px;
    }

    .title {
      font-weight: 600;
      font-size: 24px;
      margin: 0 0 24px 6px;
      color: #242424;
    }

    .card {
      background: var(--card);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: 24px;

    }

    .upload-box {
      border: 1.5px dashed var(--line);
      border-radius: 16px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }


    .upload-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 12px;
      margin-bottom: 20px;
      padding: 10px 40px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .upload-btn:active {
      background: var(--accent-press);
      transform: translateY(1px);
    }

    .upload-tip {
      position: absolute;
      bottom: 48px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #94928D;
    }

    .upload-box.dragover {
      background: #f4f8ee;
      border-color: #cfe0a6;
    }

    .fps-row {
      display: flex;
      gap: 16px;
      align-items: center;
      margin: 0px 0 24px;
    }

    .apply-btn {
      height: 44px;
      padding: 0 20px;
      border: none;
      border-radius: 12px;
      background: #47453E;
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }

    .apply-btn:active {
      background: #2f2b26;
      transform: translateY(1px);
    }

    .apply-btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    /* æ— éšœç¢éšè—ï¼šä¸è¦ display:noneï¼Œé¿å… Safari æ‹’ç»è§¦å‘ */
    input[type="file"] {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-top: 16px;
    }

    .stat {
      background: #fbfaf7;
      border: 0.5px solid var(--line);
      border-radius: 16px;
      padding: 14px 16px;
    }

    .stat b {
      display: block;
      color: #7f7d77;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .stat .v {
      font-size: 18px;
      font-weight: 700;
      color: #262626;
    }

    .card-mid {
      margin-top: 16px;
      background: var(--card);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: 24px;

    }

    .players {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .player {
      background: #fff;
      border: 0.5px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
    }

    .player-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-bottom: 0.5px solid var(--line);
      background: #faf9f6;
    }

    .ph-title {
      font-size: 12px;
      color: #6d6b66;
      font-weight: 700;
    }

    .ph-actions {
      display: flex;
      gap: 8px;
    }

    .sm-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .sm-btn:active {
      background: var(--accent-press);
    }

    .frame {
      --tile: 18px;
      --c1: #fff;
      --c2: #eee;
      height: 360px;
      background-color: var(--c1);
      background-image: conic-gradient(var(--c2)25%, var(--c1)0 50%, var(--c2)0 75%, var(--c1)0);
      background-size: var(--tile) var(--tile);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stage {
      width: 100%;
      height: 100%;
      background: transparent;
    }

    .card-bottom {
      margin-top: 16px;
      background: var(--card);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: 24px;

    }

    .section-title {
      font-size: 12px;
      color: #6d6b66;
      margin: 0px 2px 10px;
      font-weight: 700;
    }

    .modes {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .pill {
      border-radius: 12px;
      padding: 10px 14px;

      background: #f5f4f1;
      color: #6a6a63;
      cursor: pointer;
    }

    .pill.active {
      background: #D2DF93;
      color: #40443a;

      font-weight: 600;
    }

    .fps-wrap {
      margin: 18px 0 16px;
    }

    .fps-input {
      width: 280px;
      max-width: 100%;
      height: 44px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fbfaf7;
      color: #2a2a2a;
      font-size: 14px;
    }

    .fps-input::placeholder {
      color: #b3b1ab;
    }

    .submit {
      width: 100%;
      height: 46px;
      border: none;
      border-radius: 12px;
      background: #47453E;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
    }

    .submit:active {
      background: #2f2b26;
      transform: translateY(1px);
    }

    .submit:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, .82);
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s, transform .25s;
      z-index: 9999;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    @media(max-width:920px) {
      .players {
        grid-template-columns: 1fr;
      }

      .frame {
        height: 320px;
      }
    }
  </style>
  <!-- ä½¿ç”¨ unpkg é•œåƒï¼Œå‡å°‘åŠ è½½å¤±è´¥æ¦‚ç‡ -->
  <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
   <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="wrap">
    <h2 class="title">ğŸ‘Œ LottieåŠ¨ç”»å¸§ç‡ä¿®æ”¹å’ŒJsoné¢„è§ˆå·¥å…·</h2>
    <div class="card">
      <div class="upload-box" id="uploadBox">
        <input id="file" type="file" accept=".json,application/json" />
        <label for="file" class="upload-btn" id="btnPick" role="button" tabindex="0">ä¸Šä¼ æ–‡ä»¶</label>
        <div class="upload-tip">æˆ–ç›´æ¥å°† JSON æ‹–æ”¾è‡³æ­¤</div>
      </div>
      <div class="stats" id="stats" hidden>
        <div class="stat"><b>å½“å‰ fr</b>
          <div class="v" id="curFr">-</div>
        </div>
        <div class="stat"><b>å¼€å§‹å¸§ ip</b>
          <div class="v" id="curIp">-</div>
        </div>
        <div class="stat"><b>ç»“æŸå¸§ op</b>
          <div class="v" id="curOp">-</div>
        </div>
        <div class="stat"><b>æ—¶é•¿ (ç§’)</b>
          <div class="v" id="curSec">-</div>
        </div>
      </div>
    </div>

    <div class="card-mid">
      <div class="players">
        <div class="player">
          <div class="player-head">
            <div class="ph-title">æºæ–‡ä»¶é¢„è§ˆ</div>
            <div class="ph-actions">
              <button class="sm-btn" id="p1Play">æ’­</button>
              <button class="sm-btn" id="p1Pause">åœ</button>
              <button class="sm-btn" id="p1Stop">å¤</button>
            </div>
          </div>
          <div class="frame">
            <div id="stage1" class="stage"></div>
          </div>
        </div>

        <div class="player">
          <div class="player-head">
            <div class="ph-title">ä¿®æ”¹åé¢„è§ˆ</div>
            <div class="ph-actions">
              <button class="sm-btn" id="p2Play">æ’­</button>
              <button class="sm-btn" id="p2Pause">åœ</button>
              <button class="sm-btn" id="p2Stop">å¤</button>
            </div>
          </div>
          <div class="frame">
            <div id="stage2" class="stage"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card-bottom">
      <div class="section-title">é€‰æ‹©æ¨¡å¼</div>
      <div class="modes" id="modeGroup">
        <div class="pill active" data-mode="scale-keyframes">ç¼©æ”¾æ‰€æœ‰å…³é”®å¸§æ—¶é—´ï¼ˆæ¨èï¼‰</div>
        <div class="pill" data-mode="keep-duration">ä¿æŒæ•´ä½“æ—¶é•¿</div>
        <div class="pill" data-mode="just-fr">ä»…ä¿®æ”¹å¸§ç‡</div>
      </div>

      <div class="section-title" style="margin-top:24px;">ç›®æ ‡å¸§ç‡</div>

      <!-- æ–°è¡Œï¼šè¾“å…¥ + åº”ç”¨æŒ‰é’®å¹¶æ’ -->
      <div class="fps-row">
        <input id="targetFr" class="fps-input" type="number" min="1" step="1" placeholder="è¯·è¾“å…¥ç›®æ ‡å¸§ç‡ï¼ˆå¦‚ 30ï¼‰" />
        <button id="applyBtn" class="apply-btn" disabled>åº”ç”¨</button>
      </div>

      <!-- ä¸‹è½½æŒ‰é’®ï¼šåªæœ‰åº”ç”¨åæ‰å¯ç”¨ -->
      <button id="downloadBtn" class="submit" disabled>ä¸‹è½½ä¿®æ”¹åçš„JSON</button>

    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    (() => {
      const $ = s => document.querySelector(s);

      /* ========= ç»‘å®šå…ƒç´  ========= */
      const uploadBox = $('#uploadBox'), fileInput = $('#file'), pickBtn = $('#btnPick');
      const statsEl = $('#stats'), curFrEl = $('#curFr'), curIpEl = $('#curIp'), curOpEl = $('#curOp'), curSecEl = $('#curSec');
      const stage1 = $('#stage1'), stage2 = $('#stage2');
      const p1Play = $('#p1Play'), p1Pause = $('#p1Pause'), p1Stop = $('#p1Stop');
      const p2Play = $('#p2Play'), p2Pause = $('#p2Pause'), p2Stop = $('#p2Stop');
      const modeGroup = $('#modeGroup'), fpsInp = $('#targetFr');
      const applyBtn = $('#applyBtn'), downloadBtn = $('#downloadBtn');

      /* ========= çŠ¶æ€ ========= */
      let activeMode = 'scale-keyframes';
      let anim1 = null, anim2 = null;
      let originalObj = null, processedObj = null;
      let fileName = 'lottie.json';
      let hasApplied = false;

      /* ========= Toast ========= */
      const toast = $('#toast');
      function showToast(msg, ms = 1800) {
        if (!toast) return;
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), ms);
      }

      /* ========= ç»Ÿè®¡ ========= */
      function updateStats(o) {
        try {
          const fr = +o.fr, ip = +o.ip, op = +o.op;
          curFrEl.textContent = Number.isFinite(fr) ? fr : '-';
          curIpEl.textContent = Number.isFinite(ip) ? ip : '-';
          curOpEl.textContent = Number.isFinite(op) ? op : '-';
          const sec = (Number.isFinite(fr) && Number.isFinite(ip) && Number.isFinite(op) && fr > 0) ? (op - ip) / fr : NaN;
          curSecEl.textContent = Number.isFinite(sec) ? sec.toFixed(3) : '-';
          statsEl.hidden = false;
        } catch { statsEl.hidden = true; }
      }
      const deepClone = o => (window.structuredClone ? structuredClone(o) : JSON.parse(JSON.stringify(o)));

      /* ========= Lottie æ—¶é—´ç¼©æ”¾å·¥å…· ========= */
      function scaleMarkers(markers, f) { if (!Array.isArray(markers)) return; for (const m of markers) { if (typeof m.tm === 'number') m.tm *= f; if (typeof m.dr === 'number') m.dr *= f; } }
      function scaleTimeRemap(tm, f) {
        if (!tm) return;
        if (typeof tm.k === 'number') { tm.k *= f; return; }
        if (Array.isArray(tm.k)) {
          for (const kf of tm.k) {
            if (kf && typeof kf.t === 'number') kf.t *= f;
            if (kf && kf.s != null) {
              if (typeof kf.s === 'number') kf.s *= f;
              else if (Array.isArray(kf.s) && typeof kf.s[0] === 'number') kf.s[0] *= f;
            }
            if (kf && kf.e != null) {
              if (typeof kf.e === 'number') kf.e *= f;
              else if (Array.isArray(kf.e) && typeof kf.e[0] === 'number') kf.e[0] *= f;
            }
          }
        }
      }
      function scaleAllKeyframeTs(obj, f) {
        const st = [obj];
        while (st.length) {
          const cur = st.pop();
          if (!cur) continue;
          if (Array.isArray(cur)) { for (const v of cur) st.push(v); continue; }
          if (typeof cur === 'object') {
            if (Object.prototype.hasOwnProperty.call(cur, 't') && typeof cur.t === 'number') {
              const isKF = ('s' in cur) || ('e' in cur) || ('h' in cur) || ('i' in cur) || ('o' in cur) || ('hold' in cur) || ('k' in cur);
              if (isKF) cur.t *= f;
            }
            for (const k in cur) {
              const v = cur[k];
              if (k === 'tm' && v && typeof v === 'object') scaleTimeRemap(v, f);
              else if (v && typeof v === 'object') st.push(v);
            }
          }
        }
      }
      function scaleLayerInOut(layer, f) {
        if (typeof layer.ip === 'number') layer.ip *= f;
        if (typeof layer.op === 'number') layer.op *= f;
        if (typeof layer.st === 'number') layer.st *= f;
        if (layer.tm) scaleTimeRemap(layer.tm, f);
      }
      function scaleLayersDeep(layers, f) {
        if (!Array.isArray(layers)) return;
        for (const ly of layers) {
          scaleLayerInOut(ly, f);
          if (Array.isArray(ly.layers)) scaleLayersDeep(ly.layers, f);
        }
      }
      function scaleAllTimings(root, f) {
        scaleAllKeyframeTs(root, f);
        if (typeof root.ip === 'number') root.ip *= f;
        if (typeof root.op === 'number') root.op *= f;
        scaleLayersDeep(root.layers, f);
        if (Array.isArray(root.assets)) {
          for (const a of root.assets) {
            if (Array.isArray(a.layers)) scaleLayersDeep(a.layers, f);
            if (typeof a.ip === 'number') a.ip *= f;
            if (typeof a.op === 'number') a.op *= f;
            if (typeof a.st === 'number') a.st *= f;
          }
        }
        scaleMarkers(root.markers, f);
      }

      /* ========= é¢„è§ˆï¼ˆå¼ºåˆ¶é€æ˜èƒŒæ™¯ï¼‰ ========= */
      function sanitizeForPreview(src) { const o = deepClone(src); if (o && typeof o.bg !== 'undefined') delete o.bg; return o; }
      function loadAnim(container, data) {
        container.innerHTML = ''; container.style.background = 'transparent';
        const anim = lottie.loadAnimation({ container, renderer: 'svg', loop: true, autoplay: true, animationData: sanitizeForPreview(data) });
        anim.addEventListener('DOMLoaded', () => { try { const svg = anim.renderer?.svgElement; if (svg) svg.style.background = 'transparent'; } catch (_) { } });
        return anim;
      }
      function refreshPlayers() {
        if (originalObj) { if (anim1) anim1.destroy(); anim1 = loadAnim(stage1, originalObj); }
        if (processedObj) { if (anim2) anim2.destroy(); anim2 = loadAnim(stage2, processedObj); }
      }

      /* ========= ç»Ÿä¸€å¤„ç†æ–‡ä»¶ï¼ˆç‚¹å‡»/æ‹–æ‹½éƒ½ä¼šèµ°è¿™é‡Œï¼‰ ========= */
      async function handleFile(file) {
        try {
          if (!file) { showToast('æœªé€‰æ‹©æ–‡ä»¶'); return; }
          if (!/\.json$/i.test(file.name)) { showToast('è¯·ä¸Šä¼  .json æ–‡ä»¶'); }

          // è¯»å–æ–‡æœ¬ï¼šä¼˜å…ˆ file.text()ï¼Œå¤±è´¥å›é€€ FileReader
          let txt = '';
          try { txt = await file.text(); }
          catch {
            txt = await new Promise((resolve, reject) => {
              const r = new FileReader();
              r.onerror = () => reject(r.error);
              r.onload = () => resolve(String(r.result || '')); r.readAsText(file);
            });
          }
          // å» BOM
          txt = txt.replace(/^\uFEFF/, '');

          // JSON è§£æ
          const obj = JSON.parse(txt);

          // ä¿å­˜ & åˆ·æ–°
          fileName = file.name;
          originalObj = obj;
          processedObj = null;
          updateStats(originalObj);
          refreshPlayers();

          // å¯ç”¨â€œåº”ç”¨â€æŒ‰é’®ï¼Œä¸‹è½½ç¦ç”¨ï¼Œæ ‡è®°æœªåº”ç”¨
          applyBtn.disabled = false;
          downloadBtn.disabled = true;
          hasApplied = false;

          showToast('å·²è½½å…¥ï¼š' + fileName);
        } catch (err) {
          console.error('[handleFile]', err);
          showToast('æ–‡ä»¶å¤„ç†å¤±è´¥æˆ– JSON è§£æå¤±è´¥');
        }
      }

      /* ========= ä¸Šä¼ äº¤äº’ï¼šç‚¹å‡» / æ‹–æ‹½ ========= */
      // å¦‚æœä¸æ˜¯<label for=file>ï¼Œæ‰å…œåº•è§¦å‘
      if (pickBtn && pickBtn.tagName !== 'LABEL') {
        pickBtn.addEventListener('click', () => fileInput.click());
      }

      // å…¨å±€é˜»æ­¢æµè§ˆå™¨æ¥ç®¡æ‹–æ‹½ï¼ˆé¿å…ç›´æ¥æ‰“å¼€æ–‡ä»¶è¦†ç›–é¡µé¢ï¼‰
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
        window.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); }, { passive: false });
      });

      // æ‹–æ‹½è§†è§‰åé¦ˆï¼ˆè®¡æ•°é¿å…æŠ–åŠ¨ï¼‰
      let dragCounter = 0;
      uploadBox.addEventListener('dragenter', () => { dragCounter++; uploadBox.classList.add('dragover'); });
      uploadBox.addEventListener('dragleave', () => { dragCounter = Math.max(0, dragCounter - 1); if (dragCounter === 0) uploadBox.classList.remove('dragover'); });
      uploadBox.addEventListener('dragover', () => { /* å¿…é¡» preventDefault æ‰èƒ½è§¦å‘ drop */ });

      // æ¥æ”¶æ–‡ä»¶ï¼ˆæ‹–æ‹½ï¼‰
      uploadBox.addEventListener('drop', async e => {
        dragCounter = 0; uploadBox.classList.remove('dragover');
        const files = e.dataTransfer?.files;
        if (!files || !files.length) { showToast('æ²¡æœ‰æ£€æµ‹åˆ°æ–‡ä»¶'); return; }
        const f = Array.from(files).find(x => /\.json$/i.test(x.name)) || files[0];
        await handleFile(f);
      });

      // é€‰æ‹©æ–‡ä»¶ï¼ˆç‚¹å‡»ï¼‰
      fileInput.addEventListener('change', async (e) => {
        const f = e.target.files && e.target.files[0];
        await handleFile(f);
        // æ¸…ç©ºä»¥ä¾¿ä¸¤æ¬¡é€‰æ‹©åŒåæ–‡ä»¶ä¹Ÿä¼šè§¦å‘ change
        e.target.value = '';
      });

      /* ========= æ¨¡å¼é€‰æ‹© ========= */
      modeGroup.addEventListener('click', e => {
        const pill = e.target.closest('.pill');
        if (!pill) return;
        [...modeGroup.children].forEach(el => el.classList.remove('active'));
        pill.classList.add('active');
        activeMode = pill.dataset.mode;
        // åˆ‡æ¢æ¨¡å¼åéœ€è¦é‡æ–°â€œåº”ç”¨â€æ‰èƒ½ä¸‹è½½
        hasApplied = false;
        downloadBtn.disabled = true;
      });

      /* ========= ä¸‹è½½å·¥å…· ========= */
      function autoDownload(name, text) {
        const blob = new Blob([text], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = name; a.click();
        setTimeout(() => URL.revokeObjectURL(url), 800);
      }

      /* ========= â€œåº”ç”¨â€é€»è¾‘ï¼šåªè®¡ç®—å¹¶é¢„è§ˆï¼Œä¸ä¸‹è½½ ========= */
      applyBtn.addEventListener('click', () => {
        if (!originalObj) { showToast('è¯·å…ˆä¸Šä¼  JSON æ–‡ä»¶'); return; }
        const newFr = +fpsInp.value;
        if (!Number.isFinite(newFr) || newFr <= 0) { showToast('ç›®æ ‡å¸§ç‡æ— æ•ˆ'); return; }

        const obj = deepClone(originalObj);
        const oldFr = +obj.fr; const hadFr = Number.isFinite(oldFr) && oldFr > 0;
        const ip = +obj.ip, op = +obj.op; const hadRange = Number.isFinite(ip) && Number.isFinite(op);
        const factor = hadFr ? (newFr / oldFr) : 1;

        try {
          if (activeMode === 'just-fr') {
            obj.fr = newFr;

          } else if (activeMode === 'keep-duration') {
            obj.fr = newFr;
            if (hadRange) {
              const secs = (op - ip) / (hadFr ? oldFr : newFr);
              obj.op = ip + secs * newFr;
            }
            const rf = (hadFr ? (newFr / oldFr) : 1);
            if (Array.isArray(obj.layers)) {
              for (const ly of obj.layers) {
                if (typeof ly.ip === 'number') ly.ip *= rf;
                if (typeof ly.op === 'number') ly.op *= rf;
                if (typeof ly.st === 'number') ly.st *= rf;
              }
            }
            if (Array.isArray(obj.assets)) {
              for (const a of obj.assets) {
                if (Array.isArray(a.layers)) {
                  for (const ly of a.layers) {
                    if (typeof ly.ip === 'number') ly.ip *= rf;
                    if (typeof ly.op === 'number') ly.op *= rf;
                    if (typeof ly.st === 'number') ly.st *= rf;
                  }
                }
              }
            }
            if (Array.isArray(obj.markers)) {
              for (const m of obj.markers) {
                if (typeof m.tm === 'number') m.tm *= rf;
                if (typeof m.dr === 'number') m.dr *= rf;
              }
            }

          } else { // 'scale-keyframes'
            obj.fr = newFr;
            if (hadFr) { scaleAllTimings(obj, factor); }
            else { showToast('æœªæ£€æµ‹åˆ°æ—§å¸§ç‡ï¼Œä»…è®¾ç½® fr'); }
          }

          processedObj = obj;
          updateStats(processedObj);  // ç”¨ä¿®æ”¹åçš„æ•°æ®æ›´æ–°ç»Ÿè®¡
          refreshPlayers();           // å³ä¾§é¢„è§ˆæ›´æ–°

          hasApplied = true;
          downloadBtn.disabled = false; // å…è®¸ä¸‹è½½
          showToast('å·²åº”ç”¨ï¼Œé¢„è§ˆå·²æ›´æ–°');
        } catch (e) {
          console.error(e);
          showToast('åº”ç”¨å¤±è´¥');
        }
      });

      /* ========= â€œä¸‹è½½â€é€»è¾‘ï¼šå¿…é¡»å…ˆâ€œåº”ç”¨â€ ========= */
      downloadBtn.addEventListener('click', () => {
        if (!processedObj || !hasApplied) {
          showToast('è¯·å…ˆç‚¹å‡»â€œåº”ç”¨â€');
          return;
        }
        const newFr = +fpsInp.value || processedObj.fr || 0;
        const outName = (fileName || 'lottie.json')
          .replace(/\.json$/i, '')
          + `-fr${newFr}${activeMode === 'scale-keyframes' ? '-scaled' : activeMode === 'keep-duration' ? '-keepdur' : ''}.json`;

        autoDownload(outName, JSON.stringify(processedObj, null, 2));
        showToast('å·²ä¸‹è½½ï¼š' + outName);
      });

      /* ========= æ’­æ”¾æ§åˆ¶ ========= */
      p1Play.addEventListener('click', () => anim1 && anim1.goToAndPlay(0, true));
      p1Pause.addEventListener('click', () => anim1 && anim1.pause());
      p1Stop.addEventListener('click', () => anim1 && anim1.stop());
      p2Play.addEventListener('click', () => anim2 && anim2.goToAndPlay(0, true));
      p2Pause.addEventListener('click', () => anim2 && anim2.pause());
      p2Stop.addEventListener('click', () => anim2 && anim2.stop());
    })();

  </script>
  <footer class="footer">
    <a href="https://www.feishu.cn/invitation/page/add_contact/?token=ddahf0f4-5350-44be-abd2-956d2c0a577a&unique_id=ZYyg0Hbu5gpY66zPvQkbIA==" 
     class="footer-content" target="_blank" rel="noopener noreferrer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <title>mail_send_line</title>
       <g id="mail_send_line" fill="none">
        <path d="M24 0v24H0V0z"/>
        <path fill="currentColor" d="M20 4a2 2 0 0 1 1.995 1.85L22 6v12a2 2 0 0 1-1.85 1.995L20 20H4a2 2 0 0 1-1.995-1.85L2 18v-1h2v1h16V7.414l-6.94 6.94a1.5 1.5 0 0 1-2.007.103l-.114-.103L4 7.414V8H2V6a2 2 0 0 1 1.85-1.995L4 4zM6 13a1 1 0 1 1 0 2H1a1 1 0 1 1 0-2zm12.586-7H5.414L12 12.586zM5 10a1 1 0 0 1 .117 1.993L5 12H2a1 1 0 0 1-.117-1.993L2 10z"/>
      </g>
      </svg>
      <span>Contact Eric Sun</span>
    </a>
  </footer>


</body>

</html>
